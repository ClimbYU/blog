<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        html,
        body {
            padding: 0;
            margin: 0;
        }

        .rotate-left {
            margin-top: 200px;
            margin-left: 100px;
            width: 200px;
            height: 200px;
            background-color: forestgreen;
            border-radius: 15px;
            transition: all linear 0.3s;
        }
    </style>
</head>
<body>
    <div class="rotate">
        <div class="rotate-left">
        </div>
    </div>
    <script>
        let startPosX, startPosY;
        let eleX, eleY;
        let rotateDeg = 0;
        let flag = false
        const rotate = document.querySelector('.rotate-left')
        // 获取元素点击原始坐标
        rotate.addEventListener('mousedown', (e) => {
            flag = true
            startPosX = e.pageX
            startPosY = e.pageY
        }, false)
        // 获取元素中心点坐标
        const boundClient = rotate.getBoundingClientRect()
        eleX = boundClient.width / 2 + boundClient.x
        eleY = boundClient.height / 2 + boundClient.y
        console.log(boundClient, eleX, eleY)

        rotate.addEventListener('mousemove', (e) => {
            if(flag){
                const center2Start = calculateDistance(eleX,eleY,startPosX,startPosY)
                // const moveX = e.pageX - startPosX
                // const moveY = e.pageY - startPosY
                const center2End = calculateDistance(eleX,eleY,e.pageX,e.pageY)
                const start2end = calculateDistance(startPosX,startPosY,e.pageX,e.pageY)
                const isClockwise = getClockwiseOrNot(
                    {X:startPosX,Y:startPosY},
                    {X:e.pageX,Y:e.pageY}
                )
                // if(e.pageX - startPosX < 0 || e.pageY - startPosY < 0){
                //     rotateDeg -= getRotate(center2End,center2Start,start2end)
                // }else{
                //     rotateDeg += getRotate(center2End,center2Start,start2end)
                // }
                rotateDeg += getRotate(center2End,center2Start,start2end)
                rotate.style.transform = `rotate(${rotateDeg}deg)`;
                startPosY = e.pageY
                startPosX = e.pageX
            }
        }, false)
        rotate.addEventListener('mouseup', (e) => {
            // startPosX = e.pageX
            // startPosY = e.pageY
            // console.log(rotateDeg)
            // startPosY = e.pageY
            // startPosX = e.pageX
            flag = false
        }, false)
        function calculateDistance(x1, y1, x2, y2) {
            const deltaX = x2 - x1;
            const deltaY = y2 - y1;
            
            // 使用 Math.sqrt 函数计算平方根
            const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
            
            return distance;
        }

        function getRotate(a,b,c){
            // 计算余弦值
            const cosTheta = (a * a + b * b - c * c) / (2 * a * b);

            // 使用反余弦函数计算角度（弧度）
            const radians = Math.acos(cosTheta);

            // 将弧度转换为度数
            const degrees = (radians * 180) / Math.PI;
            
            return degrees
        }
        function getClockwiseOrNot(pointB, pointC){
                const X1 = (pointB.X - eleX);
                const Y1 = (pointB.Y - eleY);
                const X2 = (pointC.X - eleX);
                const Y2 = (pointC.Y - eleY);                   // 分别求出AB,AC的向量坐标表示
                var direct = (X1 * Y2) - (Y1 * X2); 
                console.log(direct > 0 ? '顺时针' : '逆时针')
        }
    </script>
    
</body>
</html>